<div class="container">
  <h1 class="text-center">S'Cape: Ma√Ætre du jeu</h1>


  <div class="row">
    <div class="col-sm-6">
      <div class="form-group">
        <h4 class="control-label">Envoyer un message</h4>
        <textarea class="form-control" id="messageContent" rows="3"></textarea>
      </div>
      <button class="btn btn-default" id="sendButton">Envoyer</button>

      <h4>Historique des messages</h4>
      <ul id="messages-history">
        {{#each messages}}
          <li>{{.}}</li>
        {{/each}}
      </ul>
    </div>
    <div class="col-sm-6">
      <h4>Liste des photos disponibles {{tokens}}</h4>
    </div>
  </div>

  <div id="error-handler"><div id="error-message"></div></div>
</div>

<script>
  var socket = io();
  socket.on('messages updated', function(messages) {
    location.reload()
  })

  socket.on('message error', function(error) {
    document.getElementById('error-message').innerHTML = `Erreur : ${error}`;
    document.getElementById('error-handler').classList.add('active');
    setTimeout(function() {
      document.getElementById('error-handler').classList.remove('active');
    }, 5000)
  })

  function sendMessage() {
    socket.emit('send message', document.getElementById('messageContent').value, function(err) {
      if (!err) {
        document.getElementById('messageContent').value = '';
      }
    });
  }

  document.getElementById('sendButton').addEventListener('click', sendMessage);

  document.getElementById('messageContent').addEventListener('keyup', function(evt) {
    if (evt.ctrlKey && evt.keyCode === 13) {
      sendMessage();
    }
  })

  document.getElementById('messageContent').focus();
</script>
